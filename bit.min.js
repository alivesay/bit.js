'use strict';var bit={core:{}};bit.core.bit_noop={};bit.core.BitUtil={};var bit_noop=function(){},BitUtil={arrayIndexOf:function(a,b){var c,d=a.length;for(c=0;c<d;c++)if(a[c]===b)return c;return-1},arrayRemove:function(a,b){var c=this.arrayIndexOf(a,b);-1!==c&&a.splice(c,1)},isLittleEndian:function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);(new Uint32Array(a))[0]=3735928559;return 239===b[0]}};bit.core.BitObject={};
var BitObject={mixins:null,instanceID:0,className:"BitObject",generateID:function(){return BitObject.id++},create:function(){var a=Object.create(this);a.instanceID=this.generateID();this._construct.apply(a,arguments);return a},extend:function(a,b,c,d){var e=Object.create(this),f,g;c=c||{};e.className=a;if(b)for(f=Object.getOwnPropertyNames(b),g=f.length;g--;)a=f[g],c.hasOwnProperty(a)||(e[a]=b[a]);if(d)for(e.mixins=[],g=d.length;g--;){e.mixins.push(d[g]);if(d[g].mixins)for(b=d[g].mixins.length;b--;)-1===
BitUtil.arrayIndexOf(e.mixins,d[g].mixins[b])&&e.mixins.push(d[g].mixins[b]);f=Object.getOwnPropertyNames(d[g]);for(b=f.length;b--;)a=f[b],e.hasOwnProperty(a)||(e[a]=d[g][a])}if(this.mixins)for(g=this.mixins.length;g--;)-1===BitUtil.arrayIndexOf(e.mixins,this.mixins[g])&&e.mixins.push(this.mixins[g]);Object.defineProperties(e,c);return e},_construct:bit_noop,_constructMixin:function(a,b){-1!==BitUtil.arrayIndexOf(this.mixins,a)&&a._construct.apply(this,b)},_super:function(a,b,c){return Object.getPrototypeOf(a)[b].apply(this,
c)}};bit.core.BitColor={};
var BitColor=BitObject.extend("BitColor",{AMASK:4278190080,BMASK:16711680,GMASK:65280,RMASK:255,RGBMASK:16777215,ASHIFT:24,BSHIFT:16,GSHIFT:8,RSHIFT:0,_construct:function(){BitUtil.isLittleEndian()||(this.AMASK=255,this.BMASK=65280,this.GMASK=16711680,this.RMASK=4278190080,this.RGBMASK=4294967040,this.ASHIFT=0,this.BSHIFT=8,this.GSHIFT=16,this.RSHIFT=24)},getColor:function(a,b,c,d){return((void 0===d?255:d)<<this.ASHIFT|c<<this.BSHIFT|b<<this.GSHIFT|a<<this.RSHIFT)>>>0},blendColors:function(a,b){var c=
a>>this.RSHIFT&255,d=a>>this.GSHIFT&255,e=a>>this.BSHIFT&255,f=a>>this.ASHIFT&255,g=b>>this.RSHIFT&255,h=b>>this.GSHIFT&255,k=b>>this.BSHIFT&255;return 0===f?b:c*f+g*(255-f)>>8<<this.RSHIFT|d*f+h*(255-f)>>8<<this.GSHIFT|e*f+k*(255-f)>>8<<this.BSHIFT|f<<this.ASHIFT}});bit.core.BitBuffer={};
var BitBuffer=BitObject.extend("BitBuffer",{width:0,height:0,canvas:null,canvasCtx:null,data:null,dataLUT:null,_canvasCtxImageData:null,_buf:null,_buf8:null,_construct:function(a,b){this.width=a||this.width;this.height=b||this.height;this.dataLUT=this._buildLUT(this.width,this.height);this.canvas=document.createElement("canvas");this.canvas.id="bit_buffer_"+(new Date).getTime().toString();this.canvas.width=this.width;this.canvas.height=this.height;this.canvasCtx=this.canvas.getContext("2d");this.canvasCtx.imageSmoothingEnabled=
!1;this.canvasCtx.webkitImageSmoothingEnabled=!1;this.canvasCtx.mozImageSmoothingEnabled=!1;this._canvasCtxImageData=this.canvasCtx.createImageData(this.width,this.height);this._buf=new ArrayBuffer(this._canvasCtxImageData.data.length);this._buf8=new Uint8ClampedArray(this._buf);this.data=new Uint32Array(this._buf)},_buildLUT:function(a,b){var c,d,e=[];e.length=a;for(c=0;c<a;c++)for(e[c]=[],e[c].length=b,d=0;d<b;d++)e[c][d]=c+d*a;return e},clear:function(a){for(var b=this.data.length;b--;)this.data[b]=
a},putPixel:function(a,b,c,d,e,f){0>a||a>=this.width||0>b||b>=this.height||(this.data[this.dataLUT[a][b]]=f<<this.ASHIFT|e<<this.BSHIFT|d<<this.GSHIFT|c<<this.RSHIFT)},blit:function(a,b,c){var d=a.data,e=a.width;a=a.height;var f=e,g=a;b+=e;for(var h=c+a,k;f--;){for(b--;g--;)h--,0>b||0>h||b>=this.width||h>=this.height||(k=f+g*e,d[k]>>this.ASHIFT&this.AMASK&&(this.data[this.dataLUT[b][h]]=this.blendColors(d[k],this.data[this.dataLUT[b][h]])|this.AMASK));g=a;h=c+a}},blitNoAlpha:function(a,b,c){var d=
a.data,e=a.width;a=a.height;var f=e,g=a;b+=e;for(var h=c+a;f--;){for(b--;g--;)h--,0>b||b>=this.width||0>h||h>=this.height||(this.data[this.dataLUT[b][h]]=d[f+g*e]|BitColor.AMASK);g=a;h=c+a}},drawLine:function(a,b,c,d,e){for(var f=Math.abs(c-a),g=a<c?1:-1,h=Math.abs(d-b),k=b<d?1:-1,l=(f>h?f:-h)>>1,m=l;;){0<=a&&0<=b&&a<this.width&&b<this.height&&(this.data[this.dataLUT[a][b]]=e);if(a===c&&b===d)break;m>-f&&(l-=h,a+=g);m<h&&(l+=f,b+=k)}},drawRect:function(a,b,c,d,e){},fillRect:function(a,b,c,d,e){var f=
Math.max(0,a),g=Math.max(0,b);a=Math.min(this.width,a+c);b=Math.min(this.height,b+d);d=a;for(a=b;d-- >f;){for(;a-- >g;)this.data[this.dataLUT[d][a]]=BitColor.blendColors(e,this.data[this.dataLUT[d][a]])|this.AMASK;a=b}}});bit.core.BitDimensions={};var BitDimensions=BitObject.extend("BitDimensions",{width:0,height:0,_construct:function(a,b){this.width=a||this.width;this.height=b||this.height}});bit.core.BitEntityManager={};
var BitEntityManager=BitObject.extend("BitEntityManager",{entities:null,addEntity:function(a,b){this.entities=this.entities||[];a.id=b||null;a.parent=this;this.entities.push(a)},removeEntity:function(a){this.entities&&(BitUtil.arrayRemove(this.entities,a),a.parent=null)},tick:function(a,b,c){for(var d=this.entities?this.entities.length:0;d--;)this.entities[d].tick(a,b,c)},render:function(a,b,c){for(var d=this.entities?this.entities.length:0;d--;)this.entities[d].render(a,b,c)},hasChildren:function(){return this.entities&&
0<this.entities.length}});bit.core.BitEvent={};var BitEvent=BitObject.extend("BitEvent",{name:null,type:"BitEvent",notifier:null,_construct:function(a,b){this.name=a;this.notifier=b||null}},{qualifiedName:{get:function(){return this.type+"."+(this.name||"UNDEFINED")}}});bit.core.BitEventHandler={};var BitEventHandler=BitObject.extend("BitEventHandler",{handleEvent:function(a){throw Error("BitEventHandler.handleEvent: No implementation for abstract method defined");}});bit.core.BitEntity={};var BitEntity=BitObject.extend("BitEntity",{id:null,active:!0,parent:null},null,[BitEventHandler,BitEntityManager]);bit.core.BitEventNotifier={};var BitEventNotifier=BitObject.extend("BitEventNotifier",{_handlers:[],addHandler:function(a,b){var c=this._handlers[b]=this._handlers[event.qualifiedName]||[];-1===BitUtil.arrayIndexOf(c,b)&&c.push(a)},handleEvent:function(a){for(var b=this._handlers[a.qualifiedName],c=b?b.length:0,d;c--;)d=b[c],d.handleEvent(a)&&BitUtil.arrayRemove(b,a.qualifiedName)}},null,[BitEventHandler]);bit.core.BitApp={};
(function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}());window.cancelRequestAnimationFrame||(window.cancelRequestAnimationFrame=window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||
window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame||bit_noop)})();
var BitApp=BitObject.extend("BitApp",{TICK_RATE:1E3/60,lastTick:Date.now(),running:!1,_initialized:!1,_running:!1,_requestAnimationFrameID:0,_timeoutID:0,_fpsCounter:{_now:0,_lastUpdate:Date.now(),_fpsFilter:20,_thisFrameFPS:0,_delta:0,fps:0,calc:function(){this._thisFrameFPS=(this._delta=(this._now=Date.now())-this._lastUpdate)?1E3/this._delta:0;this.fps+=(this._thisFrameFPS-this.fps)/this._fpsFilter;this._lastUpdate=this._now}},_construct:function(a){this.id=a;this._constructMixin(BitEventNotifier);
this._constructMixin(BitEntityManager);this.init()},init:bit_noop,start:function(){var a=this;if(this.running)throw Error("bit.run: Already running");this.running=!0;this._requestAnimationFrameID=window.requestAnimationFrame(function(){a.render()});this._timeoutID=setTimeout(function(){a.tick()},this.TICK_RATE)},stop:function(){if(!this.running)throw Error("bit.stop: Already stopped");window.cancelRequestAnimationFrame(this._requestAnimationFrameID);clearTimeout(this._timeoutID);this.running=!1},
tick:function(){for(var a=this.entities?this.entities.length:0,b=this;a--;)this.entities[a].tick(this);this.lastTick=Date.now();this._timeoutID=setTimeout(function(){b.tick()},this.TICK_RATE)},render:function(){var a=this.entities?this.entities.length:0,b=this;if(this.running){for(;a--;)this.entities[a].render(this);this._requestAnimationFrameID=window.requestAnimationFrame(function(){b.render()})}},addCanvas:function(a){this.addEntity(a)},removeCanvas:function(a){var b=document.getElementById(a.canvas.id);
a.parentElement.removeChild(b);this.removeCanvas(a)}},{canvases:{get:function(){return this.entities}},fps:{get:function(){return this._fpsCounter.fps|0}}},[BitEventNotifier,BitEntityManager]);bit.core.BitMath={};var BitMath=BitObject.extend("BitMath",{dot:function(a,b){for(var c=0,d=Math.min(a.length,b.length);d--;)c+=a[d]*b[d];return c}});bit.core.BitVector2D={};var BitVector2D=BitObject.extend("BitVector2D",{x:0,y:0,_construct:function(a,b){this.x=a||this.x;this.y=b||this.y},cross:function(a){return this.x*a.y+this.y*a.x},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=BitVector2D.create(),b=this.length();0<b&&(a.x/=b,a.y/=b);return a}});bit.core.BitRectangle={};var BitRectangle=BitObject.extend("BitRectangle",{_construct:function(a,b,c,d){this._constructMixin(BitVector2D,[a,b]);this._constructMixin(BitDimensions,[c,d])}},null,[BitVector2D,BitDimensions]);bit.core.BitScreen={};
var BitScreen=BitObject.extend("BitScreen",{_construct:function(a,b){this._constructMixin(BitRectangle,[0,0,a,b]);this._constructMixin(BitEntityManager);this._constructMixin(BitBuffer)},tick:function(a,b){for(var c=this.entities?this.entities.length:0;c--;)this.entities[c].tick(a,b,this)},render:function(a,b){for(var c=0;c!==this.entities.length;)this.entities[c].render(a,b,this),c++;this._canvasCtxImageData.data.set(this._buf8);this.canvasCtx.putImageData(this._canvasCtxImageData,0,0)}},null,[BitRectangle,
BitEntityManager,BitBuffer]);bit.core.BitCanvas={};
var BitCanvas=BitObject.extend("BitCanvas",{width:0,height:0,scale:1,canvas:null,canvasCtx:null,parentElement:null,_construct:function(a,b,c,d){this._constructMixin(BitEntityManager);this.parentElement=a;this.width=b;this.height=c;this.scale=d||this.scale;this.addEntity(BitScreen.create(this.width,this.height));this.canvas=document.createElement("canvas");this.canvas.width=this.width*this.scale;this.canvas.height=this.height*this.scale;this.canvasCtx=this.canvas.getContext("2d");this.canvasCtx.imageSmoothingEnabled=
!1;this.canvasCtx.webkitImageSmoothingEnabled=!1;this.canvasCtx.mozImageSmoothingEnabled=!1;1<this.scale&&this.canvasCtx.setTransform(this.scale,0,0,this.scale,0,0);this.canvas.id="bit_screen_"+Date.now();this.parentElement.appendChild(this.canvas)},_swapBuffer:function(){this._postProcess();this._canvasCtxImageData.data.set(this._buf8);1<this.scale?(this.backBufferCtx.putImageData(this.backBufferCtxImageData,0,0),this._overlay(),this.canvasCtx.drawImage(this.backBufferCanvas,0,0)):(this.canvasCtx.putImageData(this.backBufferCtxImageData,
0,0),this._overlay())},tick:function(a){for(var b=this.entities?this.entities.length:0;b--;)this.entities[b].tick(a,this)},render:function(a){for(var b=this.entities?this.entities.length:0;b--;)this.entities[b].render(a,this),this.canvasCtx.drawImage(this.entities[b].canvas,0,0)},addScreen:function(a){this.addEntity(a)},removeScreen:function(a){this.removeEntity(a)}},{screens:{get:function(){return this.entities}}},[BitEntityManager]);bit.core.BitSpriteEntity={};var BitSpriteEntity=BitEntity.extend("BitSpriteEntity",{buffer:null,frameCount:0,velocity:null,_construct:function(a){a&&(this._constructMixin(BitRectangle,[0,0,a.width,a.height]),this.buffer=a);this.velocity=BitVector2D.create(0,0)},tick:function(){this.x+=this.velocity.x;this.y+=this.velocity.y},render:function(a,b,c){c.blitNoAlpha(this.buffer,this.x,this.y)}},null,[BitRectangle]);
